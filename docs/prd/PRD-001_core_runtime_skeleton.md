# PRD-001: Core Runtime Skeleton (Policy-Neutral Engine)

## Objective
Establish a minimal, domain-neutral orchestration engine skeleton that executes a fixed pipeline while remaining completely agnostic to specific workflows or domains.

## Background
To prevent "domain bleed" and hardcoded logic, the runtime must be a pure "context-assembling machine." It should not know about specific tasks (like coding or PRD writing) but should know how to execute the assembly process.

## Scope
- Implementation of the core `LangGraph` state and nodes.
- Definition of the fixed execution pipeline.
- Abstraction of memory and document loading interfaces.

## Non-Goals
- Implementation of specific phases (e.g., IMPLEMENT, DIAGNOSE).
- Built-in repository scanning logic.
- Domain-specific prompt templates.

## Architecture
The runtime executes a fixed, linear pipeline where each node's behavior is parameterized by the current `policyRef`:

```text
[START] 
  --> PolicyResolutionStep (Resolves mode via policy)
  --> LoadDocsForMode (Bundle-based)
  --> ContextSelect (Memory + Retrieval)
  --> PromptAssemble (Template-based)
  --> LLMCall (Adapter-based)
  --> MemoryWrite (Persistence)
[END]
```

The core engine executes an abstract execution plan generated by the policy resolution step. The engine does not interpret workflow semantics; it only executes ordered steps defined by the resolved plan. The `executionPlan` is the only structure interpreted by the core engine. Mode identifiers are treated as metadata and have no behavioral meaning inside the engine.

## Data Structures
### GraphState
- **`executionPlan`**: Step[] (An ordered list of abstract execution steps resolved by the policy layer.)
- **`currentMode`**: string (Optional metadata label provided by policy; not interpreted by the core engine.)
- `memoryRef`: object (Pointer/ID for the conversation history).
- `docBundleRef`: string[] (List of document IDs/paths to be loaded).
- `policyRef`: object (The active policy configuration, immutable for the duration of a single execution cycle).
- `assembledPrompt`: string (The final string sent to the LLM).
- `lastResponse`: string (The raw output from the LLM).

## Execution Rules
1. **No Hardcoding:** The engine must not contain any strings related to "coding," "tests," or specific project phases.
2. **Policy Dependency:** Every node except the initial resolution must rely on the output of the previous node and the `policyRef`.
3. **Workflow Neutrality:** The core engine does not determine workflow transitions. It executes the mode resolved by the policy layer.
4. **No Mode-Based Branching:** The core engine must not branch logic based on `currentMode` values. All execution behavior must derive solely from the `executionPlan` structure.
5. **Fallback Mechanism:** If no policy is resolved, the engine executes a minimal pass-through behavior defined by a default runtime policy.

## Success Criteria
- The engine can execute a full loop and return an LLM response.
- The engine can run in a "blank" state without any domain-specific files.
- Switching a `policyRef` object at runtime changes the context assembly behavior without modifying code.
