# B-001 : Contract Spec
(목차 항목 생성 및 저장)

---

## 1. 목적

본 Contract는
PRD-001 「목차 항목 생성 및 저장」의 의도를
기술적으로 강제하기 위한 규약이다.

이 Contract에 정의되지 않은 동작은
구현 및 실행될 수 없다.

---

## 2. 계약 범위 (Scope)

### 포함
- 목차 항목 생성(Create)
- 데이터베이스 저장
- 고유 ID 발급
- 저장 결과 확인(Read by ID)

### 제외
- 목차 항목 수정(Update)
- 목차 항목 삭제(Delete)
- md 파일 연동
- 사용자/권한/협업
- 정렬, 이동, UI 편집 기능

---

## 3. 용어 정의

### 목차 항목 (TOC Item)
- 저서의 논리적 구조를 나타내는 최소 단위
- 시스템 내부에서 고유 ID로 식별된다

---

## 4. 입력 계약 (Input Contract)

### 4.1 필수 입력 필드

| 필드명 | 타입 | 설명 |
|------|------|------|
| title | string | 목차 항목의 제목 |

### 4.2 선택 입력 필드

| 필드명 | 타입 | 설명 |
|------|------|------|
| parent_id | string \| null | 상위 목차 항목 ID |

### 4.3 입력 불변식 (Invariant)

- title은 빈 문자열일 수 없다
- title은 공백만으로 구성될 수 없다
- parent_id가 제공된 경우,
  해당 ID는 이미 존재하는 목차 항목이어야 한다

---

## 5. 출력 계약 (Output Contract)

### 5.1 성공 응답

저장이 성공한 경우,
시스템은 반드시 다음 정보를 반환해야 한다.

| 필드명 | 타입 | 설명 |
|------|------|------|
| id | string | 생성된 목차 항목의 고유 ID |
| title | string | 저장된 제목 |
| parent_id | string \| null | 상위 항목 ID |
| created_at | datetime | 생성 시각 |

---

### 5.2 실패 응답

다음 조건 중 하나라도 위반되면
저장은 실패해야 한다.

- 필수 입력 누락
- 입력 불변식 위반
- parent_id 참조 오류

실패 시:
- 새로운 ID는 생성되지 않는다
- 데이터베이스에는 **어떠한 변경도 발생하지 않는다**

---

## 6. 저장 계약 (Persistence Contract)

### 6.1 고유 ID 규칙

- 모든 목차 항목은 고유 ID를 가져야 한다
- ID는 시스템 내부에서 충돌 없이 생성되어야 한다
- ID 생성 규칙은 구현 세부사항으로 하되,
  외부에서는 문자열로만 취급한다

---

### 6.2 트랜잭션 불변식

- 저장 과정은 원자적이어야 한다
- 저장 실패 시, 부분 저장은 허용되지 않는다
- 성공 응답을 반환한 항목은
  즉시 ID 기준 조회가 가능해야 한다

---

## 7. 조회 계약 (Read by ID)

- 생성된 목차 항목은 ID로 조회 가능해야 한다
- 조회 결과는 저장 시점의 데이터와 일치해야 한다
- 존재하지 않는 ID에 대한 조회는
  “존재하지 않음”으로 명확히 구분되어야 한다

---

## 8. 검증 규칙 (Verification Rules)

다음 검증이 자동화 가능해야 한다.

1. 정상 입력 → 저장 성공 → ID 반환
2. 저장 직후 ID 조회 → 동일 데이터 반환
3. 잘못된 입력 → 저장 실패 → DB 변경 없음
4. 잘못된 parent_id → 저장 실패
5. 실패 케이스 후 → 신규 항목 수 증가 없음

하나라도 실패하면
본 Contract는 위반된 것이다.

---

## 9. 확장 안전성 선언

본 Contract는
향후 다음 기능과 충돌하지 않아야 한다.

- md 파일과의 1:1 또는 1:N 연결
- 목차 항목 수정/삭제
- 계층 구조 확장
- 버전 관리

그러나 본 Contract는
해당 기능을 **구현하거나 요구하지 않는다**.

---

## 10. 계약 우선성

- 본 Contract는 구현 코드보다 우선한다
- 테스트, API, UI는 본 Contract를 위반할 수 없다
- 본 Contract를 변경하려면
  반드시 PRD 및 Intent Map 수정이 선행되어야 한다
