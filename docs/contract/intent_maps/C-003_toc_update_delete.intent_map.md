# C-003 : Intent → Contract Map
(PRD-003 : 목차 항목 수정 및 삭제)

---

## 1. 목적

본 문서는 PRD-003에 정의된 "수정 및 삭제" 관련 의도를
Contract B-003의 구체적 제약 조건으로 매핑한다.

---

## 2. Intent 목록

### A-1. 목차 항목의 속성을 변경한다 (Update)
- **의도**: 제목, 위치(부모), 순서를 개별적으로 수정할 수 있어야 한다.
- **제약**: 다른 항목에 영향을 주지 않는 "단건 수정"이어야 한다.

### A-2. 목차 항목을 삭제한다 (Delete)
- **의도**: 더 이상 필요 없는 항목을 제거한다.
- **제약**: 실수로 인한 대량 데이터 손실(하위 트리 삭제)을 방지해야 한다.

### A-3. 시스템 복잡도를 최소화한다
- **의도**: 자동 정렬, 연쇄 삭제 등 복잡한 부가 로직을 배제한다.

---

## 3. Intent → Contract 규칙 매핑

### Intent A-1 (Update) → Contract B-003

| Contract ID | 규칙 요약 | 매핑 근거 |
|------------|-----------|-----------|
| B-003-UP-1 | `title`, `parentId`, `order` 필드만 수정 허용 | Update 허용 필드 제한 정책 |
| B-003-UP-2 | `order` 변경 시 형제 노드 재정렬 금지 | 자동 정렬/재배치 금지 정책 |
| B-003-UP-3 | `parentId` 변경 시 순환 참조 검사 필수 | 데이터 무결성 보장 |

### Intent A-2 (Delete) → Contract B-003

| Contract ID | 규칙 요약 | 매핑 근거 |
|------------|-----------|-----------|
| B-003-DEL-1 | 자식이 있는 항목은 삭제 불가 (Fail if has children) | Cascade Delete 금지 정책 |
| B-003-DEL-2 | 단일 항목 삭제만 허용 | 단일 항목 삭제 정책 |

---

## 4. 구현 및 검증 시나리오

### 시나리오 1: 안전한 삭제
- **Given**: 항목 A가 항목 B를 자식으로 가짐
- **When**: 항목 A 삭제 요청
- **Then**: **실패(Error)** 반환 (B-003-DEL-1 위반)

### 시나리오 2: 단순 이동
- **Given**: 항목 C (Parent: Root)
- **When**: 항목 C의 `parentId`를 D로 수정
- **Then**: C의 부모가 D로 변경됨. 다른 항목(형제들)은 변경 없음.

### 시나리오 3: 정렬 변경
- **Given**: 항목 E (`order`: 1), 항목 F (`order`: 2)
- **When**: 항목 E의 `order`를 5로 수정
- **Then**: E(`order`: 5), F(`order`: 2) 상태 유지. (F가 1로 당겨지지 않음)

---

## 5. Review Gate

- 삭제 로직이 `count(children) > 0` 체크를 수행하는가?
- 수정 로직이 대상 레코드 **외의** 다른 레코드를 update하지 않는 것이 보장되는가?